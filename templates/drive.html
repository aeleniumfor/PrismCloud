{% extends 'menu_base.html' %}
{% load staticfiles %}

{% block body %}
    <link href="{% static "custom.css" %}" rel="stylesheet">
    <script type="text/javascript" src="{% static "custom.js" %}"></script>

    <div class="ui container">

        <h1 style="padding-top: 100px">Theming Examples</h1>
        <h2 class="ui dividing header">Files</h2>
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            {{ form.title }}
            {{ form }}
            <input type="submit">
        </form>
        <div>

            <div id="DropFrame">
                <div class="ui cards" style="padding: 10px">
                    {% for i in view_file %}

                        <div class="card">
                            <div class="content">
                                <div class="header">{{ i.ori_file_name }}</div>
                                <div class="meta">
                                    <i class="file text outline icon"></i>
                                </div>
                                <div class="description">{{ i.time_stamp }}</div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <div id="output"></div>
        </div>
    </div>

    <script>

        $(function () {

            if (window.File && window.FileReader && window.FileList && window.Blob) {
                PageLoad();
            } else {
                alert('The File APIs are not fully supported in this browser.');
            }
        });

        function handleFileSelect(evt) {
            evt.stopPropagation();
            evt.preventDefault();

            var files = evt.dataTransfer.files;

            var output = [];

            for (var i = 0; i < files.length; i++) {
                console.log(files[i]);
                FileUpload(files[i], "{% url "prism:drive_file_upload" %}");
            }
        }

        function handleDragOver(evt) {
            evt.stopPropagation();
            evt.preventDefault();
            evt.dataTransfer.dropEffect = 'copy';
        }

        function PageLoad(evt) {
            var dropFrame = document.getElementById('DropFrame');
            dropFrame.addEventListener('dragover', handleDragOver, false);
            dropFrame.addEventListener('drop', handleFileSelect, false);
        }


        function FileUpload(file, url) {
            var formData = new FormData();

            formData.append('file', file);
            formData.append('csrfmiddlewaretoken', getCSRF());
            console.log(formData);
            $.ajax({
                type: 'POST',
                url: url,
                data: formData,
                dataType: 'json',
                processData: false,
                contentType: false,
                success: function (data) {
                    console.log(data);
                }
            });
        }

    </script>
{% endblock %}